# **HR 관리 시스템 프로젝트 요구사항 정의서 (PRD)**

## **1\. 개요 (Overview)**

본 문서는 대규모 데이터 처리와 복잡한 조직 관리, 동적 권한 제어가 필수적인 **차세대 HR 시스템**의 요구사항을 정의한다. 본 시스템은 **멀티 테넌트(Multi-Tenant)** 기반의 SaaS 형 모듈형 모놀리스(Modular Monolith) 아키텍처를 따르며, **CQRS** 패턴을 도입하여 쓰기(유지보수성)와 읽기(성능)를 동시에 만족시키는 것을 목표로 한다.

### **1.1 프로젝트 목표**

* **확장성:** 도메인 간 결합도를 낮추어 추후 마이크로서비스(MSA) 또는 서버리스(FaaS) 전환을 대비한다.  
* **성능:** 대용량 데이터(5년 치 급여/근태) 및 계층형 조직도의 실시간 조회를 보장한다 (Response Time \< 200ms).  
* **보안:** 역할(Role), 환경(Env), 결재 상태(State)에 따른 정교한 동적 권한 제어를 구현한다.  
* **멀티 테넌시:** 단일 인스턴스에서 여러 고객사(Tenant)를 수용하며, 고객사 간 **데이터의 완벽한 논리적 격리**를 보장한다.

## **2\. 시스템 아키텍처 원칙 (Architecture Principles)**

### **2.1 Modular Monolith & CQRS**

* **Command (쓰기):** 도메인별 모듈(modules/\*)로 엄격히 분리하며, 타 모듈의 DB 테이블 직접 접근(JOIN)을 금지한다. 통신은 오직 공개 API(Interface)와 이벤트(Event)를 통해서만 수행한다.  
* **Architecture Enforcement:** ArchUnit 등의 도구를 사용하여 빌드 시점에 모듈 간 순환 참조와 의존성 위반(예: Domain 모듈이 Query 모듈 참조 금지)을 자동 검사한다.  
* **Query (읽기):** 화면 중심의 조회 모듈(queries/\*)을 별도로 운영하며, 성능 최적화를 위해 **모든 도메인 테이블에 대한 JOIN을 허용**한다.

### **2.2 Security (Policy Enforcement)**

* **PEP (검문소):** 컨트롤러 진입 전 AOP(@RequiresPermission)를 통해 권한을 검사한다.  
* **PDP (판단소):** 권한 판단 로직은 비즈니스 로직과 분리하여 **Policy 모듈**에 집약시킨다.  
* **Scope-Based Access:** 단순 허용/거부(Boolean)가 아닌, \*\*데이터 접근 범위(DataScope)\*\*를 반환하는 구조를 채택한다.

### **2.3 Multi-Tenancy & Isolation (데이터 격리) \- \[NEW\]**

* **Tenant Context:** 모든 요청은 진입 시점(Filter/Interceptor)에서 어떤 테넌트(Company ID)의 요청인지 식별되어야 한다.  
* **Data Isolation:**  
  * **Tenant Admin & User:** 모든 DB 쿼리(Read/Write)에 WHERE company\_id \= ? 조건이 강제되어야 한다.  
  * **Super Admin:** 전체 테넌트 데이터를 조회하거나 특정 테넌트를 선택하여 조회할 수 있는 권한을 가진다.

## **3\. 핵심 기능 요구사항 (Functional Requirements)**

### **3.1 시스템 및 테넌트 관리 (Global Admin Domain) \- \[NEW\]**

| ID | 기능명 | 상세 요구사항 | 비고 |
| :---- | :---- | :---- | :---- |
| **SYS-01** | **테넌트 생성/관리** | 새로운 고객사(Company)를 생성하고, 기본 관리자 계정을 발급한다. 서비스 플랜(Basic, Pro) 및 만료일 관리 포함. | Super Admin 전용 |
| **SYS-02** | **전역 설정 관리** | 시스템 전체 공지사항, 글로벌 보안 정책(비밀번호 규칙 등)을 설정한다. |  |
| **SYS-03** | **테넌트 스위칭** | 슈퍼 어드민은 문제 해결을 위해 특정 테넌트의 관리자 뷰로 전환(Impersonation)하여 시스템을 조회할 수 있다. | 감사 로그 필수 |

### **3.2 조직 및 사용자 관리 (Core Domain)**

| ID | 기능명 | 상세 요구사항 | 비고 |
| :---- | :---- | :---- | :---- |
| **ORG-01** | **계층형 부서 관리** | 본부-실-팀 단위의 무제한 계층 구조를 지원해야 한다. (테넌트별 독립 구조) | WITH RECURSIVE |
| **ORG-02** | **부서 경로 최적화** | 조회 성능을 위해 부서 이동 시 path\_string("본부\>실\>팀")을 동기화해야 한다. |  |
| **USR-01** | **사용자 정보 관리** | 사용자는 반드시 하나의 부서와 \*\*계열사(Company)\*\*에 소속되어야 한다. | company\_id 필수 |
| **USR-02** | **리더/겸직 관리** | 특정 사용자를 부서의 리더(Leader)로 지정할 수 있어야 한다. |  |

### **3.3 결재 시스템 (Approval Engine)**

* **범용성:** 휴가, 권한 신청, 급여 정정 등 모든 업무의 결재를 처리할 수 있어야 한다.  
* **워크플로우:**  
  * **순차 결재:** 파트장 → 팀장 → 본부장 순서의 결재 라인 지원.  
  * **합의(병렬):** 특정 단계에서 N명 중 M명 이상 승인 시 통과 조건 지원. (Fail-Fast 정책 적용)  
* **후처리(Event):** 최종 승인 시 ApprovalCompletedEvent를 발행하여 타 모듈이 후속 작업을 처리하도록 한다.

### **3.4 정책 및 권한 제어 (Policy & Authorization)**

| ID | 기능명 | 상세 요구사항 | 구현 전략 |
| :---- | :---- | :---- | :---- |
| **POL-01** | **동적 스코프 계산** | 사용자의 Role(Super/Tenant Admin, User)과 의도에 따라 조회 범위(GLOBAL, COMPANY, TEAM, MY)를 계산한다. | PolicyService |
| **POL-02** | **임시 접근권(Ticket)** | 결재 승인 시, 특정 리소스에 대한 한시적 접근 권한(AccessGrant)을 발급한다. | Event Listener |
| **POL-03** | **환경 제어** | 테스트 환경(Dev)이나 특정 기간(급여 마감일)에 따른 접근 제어 규칙을 적용한다. | Config \+ AOP |

### **3.5 휴가 및 급여 (Business Domain)**

* **휴가:** 연차 생성, 사용, 잔여일 관리. (테넌트별 회계연도 기준 적용 가능해야 함)  
* **급여:** 월별 급여 데이터 관리. 민감 데이터이므로 Policy 모듈에 의해 엄격하게 마스킹 처리된다.

### **3.6 근태 관리 (Attendance Domain)**

| ID | 기능명 | 상세 요구사항 | 비고 |
| :---- | :---- | :---- | :---- |
| **ATT-01** | **출퇴근 기록** | 모바일/웹에서의 출퇴근 체크. 근무지 IP/GPS 유효성 검증 포함. |  |
| **ATT-02** | **근무 유형 관리** | 시차출퇴근제, 선택적 근로시간제 등 근무 유형 지원. | 테넌트별 설정 |
| **ATT-03** | **초과근무 관리** | 연장 근무 신청 시 결재 모듈과 연동하여 승인 후 근무 시간 인정. |  |
| **ATT-04** | **근태 마감** | 월 단위 근태 확정 프로세스. | Event Driven |

### **3.7 성과 평가 (Performance Domain)**

| ID | 기능명 | 상세 요구사항 | 비고 |
| :---- | :---- | :---- | :---- |
| **PFM-01** | **목표 설정 (KPI/OKR)** | 분기/반기별 개인 및 조직 목표 수립. |  |
| **PFM-02** | **다면 평가** | 본인/상향/동료 평가 지원. 익명성 보장 필수. |  |
| **PFM-03** | **평가 등급 산정** | 조직별 상대 평가 등급 배분(Calibration) 및 최종 등급 확정. |  |

### **3.8 채용 관리 (Recruitment Domain)**

* **공고 관리:** 채용 포지션 생성 및 채용 포털 게시.  
* **지원자 파이프라인:** 서류 \-\> 면접 \-\> 합격 프로세스 상태 관리.  
* **온보딩 연동:** 최종 합격 시 User 모듈로 데이터 이관.

### **3.9 자산 관리 (Asset Domain)**

* **지급/반납:** 자산 할당 및 이력 관리.  
* **퇴사 연동:** 퇴사 처리 시 반납 필요 자산 목록 자동 통보.

### **3.10 대시보드 및 리포팅 (Query Domain)**

* **통합 조회:** 사용자 정보, 부서 경로, 잔여 연차, 급여 합계를 한 화면에서 조회한다.  
* **HR Analytics:** 부서별/테넌트별 통계 차트 제공. (Super Admin은 전체 테넌트 통계 조회 가능)

## **4\. 데이터베이스 설계 요구사항 (Database Schema)**

### **4.1 스키마 분리 원칙**

* 물리적으로는 하나의 DB(Schema)를 사용하되, 모든 테이블에 **company\_id** 컬럼을 포함하여 논리적 파티셔닝을 수행한다. (공통 코드 테이블 등 일부 제외)

### **4.2 주요 테이블 정의**

1. **companies**: 테넌트(고객사) 정보 마스터 테이블. **\[NEW\]**  
2. **approval\_requests / steps / assignees**: 범용 결재 엔진 테이블.  
3. **departments**: parent\_id 및 path\_string 포함.  
4. **access\_grants**: 동적 권한(임시 티켓) 저장 테이블.  
5. **vacation\_balances / payrolls**: 각 도메인별 데이터 테이블.  
6. **attendance\_logs**, **evaluations**, **assets** 등 도메인 테이블.

## **5\. 인터페이스 요구사항 (API & UI)**

### **5.1 Backend API (REST)**

* **Parameter:** 조회 API는 viewMode (MY | TEAM | COMPANY | GLOBAL) 파라미터를 지원한다.  
* **Response:** 공통 JSON 포맷(Envelope) 준수. 권한 부족 시 403 Forbidden 반환.

### **5.2 Frontend (Next.js FSD)**

* **권한 가드:** \<AuthGuard\> 컴포넌트로 페이지/메뉴 제어.  
* **상태 동기화:** 로그인 시 Role 및 Ticket 정보를 받아 캐싱.

## **6\. 비기능 요구사항 (Non-Functional Requirements)**

1. **트랜잭션 관리:** Command(@Transactional)와 Query(readOnly) 분리.  
2. **확장성:** Policy 모듈의 Serverless 이관 고려.  
3. **감사 로그:** 모든 결재 및 권한 변경 행위 기록. **특히 Super Admin의 테넌트 접근 이력은 필수 기록.**